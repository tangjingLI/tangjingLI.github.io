---
layout: post
title:  "JVM的垃圾回收机制"
date:   2020-11-25 11:22:36 +0800
tags: java GC
subtitle: 'Garbage Collection ~'
---

#### Java的引用

- <b>强引用</b><br>
<font size=2>形如 Object obj = new Object()，JVM宁可报内存溢出OutOfMemory异常也不会回收强引用对象，GC 判断对象是否可达看的也是强引用<br></font>

- <b>软引用</b><br>
<font size=2>软引用描述可能还有用但非必须的对象，在内存不够用时进行回收<br></font>

- <b>弱引用</b><br>
<font size=2>弱引用也是描述可能还有用但非必须的对象，但比软引用更弱，在触发GC时回收所有的弱引用对象<br></font>

- <b>虚引用（幻引用）</b><br>
<font size=2>与对象的生命周期没有关系，只是跟踪对象什么时候被JVM回收<br></font>


#### 什么是垃圾

<font size=2>Java中的对象实例基本上都存放在堆上，因此Java的自动垃圾回收也主要是针对堆进行的，在JVM眼中，垃圾是指不能通过任何途径再次被使用的对象</font>

#### 找垃圾

- <b>引用计数法</b>
<font size=2>当一个对象被创建并且初始化赋值后，该对象的引用计数器的值就设为 1<br>每当有一个新的地方引用它时，该对象的引用计数器的值就加 1，当有一个引用失效时计数器的值就减 1<br>当一个对象的引用计数为0时，它就成为了可以被回收的垃圾<br>特别地，当一个对象被当做垃圾收集时，它引用的任何对象的计数器的值都减 1</font>


- <b>可达性分析法(根搜索法)</b>
<font size=2>根集是指正在执行的 Java 程序可以访问的引用变量（不是对象）的集合，程序可以使用引用变量访问对象的属性和调用对象的方法。根集包含许多根对象GC Roots。可达性分析法的基本思路是：将一系列的GC Roots作为起始点，从这些节点开始向下搜索，搜索所走过的路径称为引用链，如果一个对象到根对象没有任何引用链相连，那么这个对象就不是可达的，也称之为不可达对象，即为垃圾回收的目标。</font>

#### 垃圾回收

- 标记-清除算法

<font size=2><b>标记</b><br>&emsp;进行标记前需要先 Stop The World（STW），暂停应用线程以便 JVM 可以尽情地收拾家务的这种情况又被称之为安全点（Safe Point），暂停时间的长短取决于存活对象的多少。当 GC 需要中断线程的时候，不直接对线程操作，仅仅简单地设置一个标志，各个线程执行时主动去轮询这个标志，发现中断标志为真时就自己中断挂起。轮询标志地地方和安全点是重合的，另外再加上创建对象需要分配内存的地方。</font>
<font size=2><b>清除</b><br>&emsp;进行标记前</font>

- 标记-整理算法

<font size=2></font>

- 复制算法

<font size=2></font>
